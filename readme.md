# 概要

ITSS準拠の研修カリキュラム「セキュリティ基礎（B241）」のうち、「セキュアプログラミング」の一環としてSQLインジェクションを実際に起こしてみる実習用課題ソースです。

# 課題

## 事前準備
- 研修環境からアクセス可能なSQL Serverに、「Database」ディレクトリにある下記のSQL 2件でテーブルとデータを作成してください。
  - TableCreate.sql …… Monstersテーブルを生成するCreate文です。
  - DataInsert.sql …… Monstersテーブルにポケモンデータを登録するInsert文です。
- MonsterViewer.cs / SimpleSearchの「connectionString」変数に接続先サーバー情報が記述されているので、用意した環境のサーバー、DB名、ID、パスワードに書き換えてください。
- 同じく、Properties / Settings.settings にある接続先情報も書き換えてください。

## 課題1: SQLインジェクションでデータを追加する
検索条件欄に下記の文字列を入力し、「表示（ダメ）」ボタンを押してください。

```sql
' OR 1=1; insert into monsters values(231,'謎モンスター','Riddle','なぞ',null,null,null);--
```

SQL Server Managemnet Studioで、データが追加されていることを確認してください。

## 課題2: SQLインジェクションでデータを削除する

先の「データ追加」を実施した状態で、追加したデータを削除します。検索条件欄に下記の文字列を入力し、「表示（ダメ）」ボタンを押してください。

```sql
' OR 1=1; delete from monsters where no=231;--
```

SQL Server Managemnet Studioで、データが削除されていることを確認してください。

## 課題3: SQLインジェクション対策の実装

プログラムを書き換えて、SQLインジェクションが起きないようにしてもらいます。サンプルにはすでにTableAdapterとパラメーターを用いてSQLインジェクションが起きないパターンの処理が実装されていますが、ここでは敢えて、SimpleSearchメソッド内のSQL生成処理で「シングルクォートをすべて2連のシングルクォートにする」という処置で対応してみてください。

実装後、前述の課題2を再度実行し、データの追加が起きないことを確認します。

実際の業務でこのような文字列操作によるSQL生成を行う場面は少なくなっていますが、フレームワークが自動的に対応してくれている背後でどのような事を行っているか、根本と基本的な方針を学ぶために敢えて手作業で処理してもらいます。

